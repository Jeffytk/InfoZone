{% extends 'base.html' %}
{% load static %}

{% block title %}Historia - InfoZone{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/EstiloComunidad.css' %}">
<style>
    .btn-mostrar-form {
        margin-top: 2em;
        padding: 0.6em 1.8em;
        font-size: 1.1em;
        cursor: pointer;
        background: #506ee3;
        color: #fff;
        border: none;
        border-radius: 6px;
        transition: background 0.3s, transform 0.2s;
        box-shadow: 0 2px 8px #ccc;
    }
    .btn-mostrar-form:hover {
        background: #304ec7;
        transform: scale(1.04);
    }
</style>
{% endblock %}

{% block content %}
<section>
    <h2>Foro de Historia</h2>

    <div class="posts-container">
        {% for post in posts %}
        <article class="post">
            <h3><a href="{% url 'detalle_post' post.id %}">{{ post.titulo }}</a></h3>
            <div class="post-meta">
                <span class="author">{{ post.autor.username }}</span>
                <span class="date">{{ post.fecha|date:"d M Y H:i" }}</span>
            </div>
            <div class="post-content">
                <p>{{ post.mensaje|linebreaks }}</p>
            </div>
        </article>
        {% empty %}
        <p>No hay posts aún. ¡Sé el primero en publicar!</p>
        {% endfor %}
    </div>

    {% if user.is_authenticated %}
        <button class="btn-mostrar-form" id="abrirFormPost">Añadir post</button>
        <div class="nuevo-tema" style="display:none;">
            <h3>Crear nuevo tema de discusión</h3>
            <form method="post">
                {% csrf_token %}
                {{ form.as_p }}
                <button type="submit" class="btn-mostrar-form" style="background:#219e50;">Publicar</button>
            </form>
            <button type="button" class="btn-mostrar-form" id="cerrarFormPost" style="background: #c73434; margin-top:10px;">Cerrar</button>
        </div>
    {% else %}
        <p>Debes iniciar sesión para crear un nuevo tema. <a href="{% url 'login' %}">Inicia aquí</a></p>
    {% endif %}
</section>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const abrir = document.getElementById('abrirFormPost');
    const cerrar = document.getElementById('cerrarFormPost');
    const formDiv = document.querySelector('.nuevo-tema');
    if (abrir && formDiv) {
        abrir.addEventListener('click', function() {
            formDiv.style.display = 'block';
            abrir.style.display = 'none';
        });
    }
    if (cerrar && formDiv) {
        cerrar.addEventListener('click', function() {
            formDiv.style.display = 'none';
            abrir.style.display = 'inline-block';
        });
    }
});
</script>
{% endblock %}
